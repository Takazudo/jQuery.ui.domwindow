/*! jQuery.ui.domwindow - v0.1.0 -  3/28/2012
 * https://github.com/Takazudo/jQuery.ui.domwindow
 * Copyright (c) 2012 "Takazudo" Takeshi Takatsudo; Licensed MIT */((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=Array.prototype.slice;r=window,d=document,b=$(r),a=$(d),k=Math.round,q={$dialog:null,$overlay:null},r.domwindowApi=e=null,i=function(){var a;return a=$("<div><!--[if IE 6]><i></i><![endif]--></div>"),a.find("i").size()?!0:!1}(),j=function(){return $.Deferred(function(a){return a.resolve()})},n=function(){return r.innerHeight||d.documentElement.clientHeight||d.body.clientHeight},o=function(){return r.innerWidth||d.documentElement.clientWidth||d.body.clientWidth},l=function(){return r.pageYOffset||d.documentElement.scrollTop||d.body.scrollTop},m=function(){return r.pageXOffset||d.documentElement.scrollLeft||d.body.scrollLeft},p=function(a){return $.Deferred(function(b){return setTimeout(function(){return b.resolve()},a)})},$.widget("ui.hideoverlay",{options:{overlayfade:!0,spinnersrc:null,maxopacity:.8,bgiframe:!1,spinjs:!1,spinjs_options:{color:"#fff",lines:15,length:22,radius:40}},widgetEventPrefix:"hideoverlay.",_active:!1,_create:function(){return this.$el=this.element,this.$spinner=$(".ui-hideoverlay-spinner",this.$el),this.options.spinjs&&this.$spinner.css("background","none"),this.$bg=$(".ui-hideoverlay-bg",this.$el),this._preloadSpinner(),this._eventify(),this._handleIE6(),this},_attachSpinjs:function(){return this._showDefer?this._spinning?(new Spinner(this.options.spinjs_options)).spin(this.$spinner[0]):this:this},_handleIE6:function(){return i?(this._resize(),this.options.bgiframe&&$.fn.bgiframe&&this.$el.bgiframe(),this):this},_resize:function(){var a,c;return i?(c=b.width(),a=b.height(),this.$el.css({width:c,height:a,top:b.scrollTop(),left:b.scrollLeft()}),this.$bg.css({width:c,height:a})):this},_eventify:function(){var a=this;return i?(b.bind("resize scroll",function(){return a._resize()}),this):this},_showOverlayEl:function(a){var b=this;return $.Deferred(function(c){var d,e;return b.$spinner.hide(),b.$el.css("display","block"),e={opacity:0},d={opacity:b.options.maxopacity},b.options.overlayfade?$.when(b.$bg.stop().css(e).animate(d,200)).done(function(){return a||(b.options.spinjs&&(b.$spinner.show(),b._attachSpinjs()),b.$spinner.hide().fadeIn()),c.resolve()}):(b.$bg.css(d),a||(b.options.spinjs&&(b.$spinner.show(),b._attachSpinjs()),b.$spinner.show()),c.resolve())}).promise()},_hideOverlayEl:function(){var a=this;return $.Deferred(function(b){var c,d;return c={opacity:0},d=function(){return a.$el.css("display","none"),a.$spinner.show(),b.resolve()},a.options.overlayfade?$.when(a.$bg.stop().animate(c,100)).done(function(){return d()}):(a.$bg.css(c),d())}).promise()},_preloadSpinner:function(){var a;return a=this.options.spinnersrc,a?((new Image).src=a,this):this},show:function(a){var b=this;return this._showDefer?this._showDefer:this._active?j():(this._active=!0,a?this.hideSpinner():(this._spinning=!0,this.$spinner.show()),this._trigger("showstart"),this._showDefer=this._showOverlayEl(a),this._showDefer.done(function(){return b._showDefer=null,b._trigger("showend")}),this._showDefer)},hide:function(){var a=this;return this._showDefer?(this._showDefer.done(function(){return a.hide()}),this):this._active?(this._active=!1,this._trigger("hidestart"),this._hideDefer=this._hideOverlayEl(),this._hideDefer.done(function(){return a._hideDefer=null,a._trigger("hideend")}),this._hideDefer):j()},hideSpinner:function(){return this._spinning=!1,this.$spinner.stop().empty().hide(),this}}),$.ui.hideoverlay.create=function(a){var b;return b='<div class="ui-hideoverlay" id="domwindow-hideoverlay">\n  <div class="ui-hideoverlay-bg"></div>\n  <div class="ui-hideoverlay-spinner"></div>\n</div>',$(b).hideoverlay(a)},$.ui.hideoverlay.setup=function(a){var b;return q.$overlay&&(q.$overlay.hideoverlay("destroy").remove(),q.$overlay=null),b=$.ui.hideoverlay.create(a).appendTo("body"),q.$overlay=b,b},$.widget("ui.domwindowdialog",{options:{spinjs:!1,height:500,width:500,fixedMinY:30,selector_open:".apply-domwindow-open",selector_close:".apply-domwindow-close",ajaxdialog:!0,ajaxdialog_avoidcache:!0,ajaxdialog_mindelay:300,iframedialog:!1,iddialog:!1,overlay:!0,overlayclickclose:!0},widgetEventPrefix:"domwindowdialog.",_create:function(){return this.$el=this.element,this.$el.css({width:this.options.width,height:this.options.height}),this._eventify(),this},_eventify:function(){var c,d=this;return c=this,a.on("click",this.options.selector_open,function(a){var b;return a.preventDefault(),b=h(this),c.open.apply(c,b)}),a.on("click",this.options.selector_close,function(a){return a.preventDefault(),d.close()}),b.on("resize",function(){return d.center()}),this},setOverlay:function(a){var b=this;return this.options.overlay?(this.$overlay=a,this.overlay=a.data("hideoverlay"),this.options.overlayclickclose&&this.$overlay.bind("click",function(){return b.close()}),this):this},center:function(){var a,b,c,d=this;return a={},a.left=k(o()/2+m()-k(this.$el.outerWidth()/2)),b=function(){return a.top=k(n()/2+l()-k(d.$el.outerHeight()/2))},c=function(){return a.top=k(n()/2-k(d.$el.outerHeight()/2))},a.left<0&&(a.left=0),this.$el.innerHeight()+50<n()?i?(a.position="absolute",b()):a.left!==0?(a.position="fixed",c()):(a.position="absolute",b()):(a.position="absolute",a.top=this.options.fixedMinY+l()),this.$el.css(a),this},open:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,q=this;j=b,this._isOpen=!0,this._currentOpen=e={},e.defer=$.Deferred(),d=function(){if(e.killed)return;return q.$el.fadeIn(200,function(){var a;return(a=q.overlay)!=null&&a.hideSpinner(),q._trigger("afteropen",{},{dialog:q.$el}),(b!=null?b.callback:void 0)&&b.callback.apply(q.$el,[q.$el]),q._currentOpen=null}),p(0).done(function(){return q.center()}),e.defer.resolve()},h=null;if($.isFunction(a))h="deferred";else{this.options.ajaxdialog&&(h="ajax"),this.options.iframedialog&&(h="iframe"),this.options.iddialog&&(h="id");if(j!=null?j.ajaxdialog:void 0)h="ajax";if(j!=null?j.iframedialog:void 0)h="iframe";if(j!=null?j.iddialog:void 0)h="id"}h==="id"&&(c=$("#"+a),c.is(":ui-domwindow")&&(j=$.extend({},c.domwindow("createApiOpenOptions"),j))),this._attachOneTimeEvents(j,"open",e),k=(j!=null?j.width:void 0)||this.options.width,i=(j!=null?j.height:void 0)||this.options.height,this.$el.css({width:k,height:i}),this._trigger("beforeopen",{},{dialog:this.$el}),g=this.options.ajaxdialog_mindelay;switch(h){case"deferred":(l=this.overlay)!=null&&l.show(),f=$.Deferred(),a.apply(this,[f]),$.when(f,p(g)).done(function(a){return q.$el.empty().append(a),d()});break;case"ajax":(m=this.overlay)!=null&&m.show(),$.when(this._ajaxGet(a),p(g)).done(function(){var a,b;return a=1<=arguments.length?s.call(arguments,0):[],b=a[0][0],q.$el.empty().append(b),d()});break;case"iframe":(n=this.overlay)!=null&&n.show(!0),this.$el.empty().append(this._createIframeSrc(a)),d();break;case"id":(o=this.overlay)!=null&&o.show(!0),this.$el.empty().append(c.html()),d()}return e.kill=function(){return e.killed=!0},e},close:function(a){var b=this;return $.Deferred(function(c){var d;return b._isOpen?(b._attachOneTimeEvents(a,"close"),(d=b._currentOpen)!=null&&d.kill(),b._isOpen=!1,b._trigger("beforeclose",{},{dialog:b.$el}),p(0).done(function(){var a;return(a=b.overlay)!=null&&a.hide(),b.$el.fadeOut(200,function(){return c.resolve(),b._trigger("afterclose",{},{dialog:b.$el})})})):b})},_attachOneTimeEvents:function(a,b,c){var d,e=this;return a?(d=["beforeclose","afterclose"],b==="open"&&$.merge(d,["beforeopen","afteropen"]),$.each(d,function(b,d){if(a[d])return e.$el.one(""+e.widgetEventPrefix+d,function(){var b;b=1<=arguments.length?s.call(arguments,0):[];if(c!=null?c.killed:void 0)return;return a[d].apply(this.$el,b)})}),this):this},_ajaxGet:function(a){var b;return b={url:a,dataType:"text"},this.options.ajaxdialog_avoidcache&&(b.cache=!1),$.ajax(b)},_createIframeSrc:function(a){var b;return b=g(),'<iframe\n  frameborder="0" hspace="0" wspace="0" src="'+a+'" name="'+b+'"\n  style="width:100%; height:100%; border:none; background-color:#fff"\n></iframe>'}}),$.ui.domwindowdialog.create=function(a){var b;return b='<div class="ui-domwindowdialog">\n  <a href="#" class="apply-domwindow-close">close</a>\n</div>',$(b).domwindowdialog(a)},$.ui.domwindowdialog.setup=function(a){var b,d;return q.$dialog&&(q.$dialog.domwindowdialog("destroy").remove(),q.$dialog=null),b=$.ui.domwindowdialog.create(a),b.appendTo("body"),d=f(a),b.domwindowdialog("setOverlay",$.ui.hideoverlay.setup(d)),e=r.domwindowApi=new c(b),q.$dialog=b,b},f=function(a){var b;return b={},a?($.each($.ui.hideoverlay.prototype.options,function(c){if(a[c]!==void 0)return b[c]=a[c]}),b):b},h=function(a){var b,c,d,e;return b=$(a),d=[],e=b.data("domwindowUrl")||b.data("domwindowId"),e||(e=b.attr("href").replace(/^#/,"")),d.push(e),c={},b.data("domwindowAjaxdialog")&&(c.ajaxdialog=!0),b.data("domwindowIframedialog")&&(c.iframedialog=!0),b.data("domwindowIddialog")&&(c.iddialog=!0),function(){var a;a=b.data("domwindowHeight");if(a)return c.height=a}(),function(){var a;a=b.data("domwindowWidth");if(a)return c.width=a}(),d.push(c),d},g=function(){return"domwindow-uniqid-"+Math.round(Math.random()*1e3)},c=function(){function a(a){this.$dialog=a,this.dialog=this.$dialog.data("domwindowdialog")}return a.prototype.open=function(){var a;return a=1<=arguments.length?s.call(arguments,0):[],this.dialog.open.apply(this.dialog,a)},a.prototype.close=function(){var a;return a=1<=arguments.length?s.call(arguments,0):[],this.dialog.close.apply(this.dialog,a)},a}(),$.widget("ui.domwindow",{options:{iddialog:!0},widgetEventPrefix:"domwindow.",_create:function(){var a=this;return this.$el=this.element,$.ui.domwindowdialog.setup(),this._id=this.$el.attr("id")||function(){var b;return b=g(),a.$el.attr("id",b),b}(),this},createApiOpenOptions:function(){var a,b;return b=this,a=$.extend({},this.options),delete a.beforeopen,delete a.afteropen,delete a.beforeclose,delete a.afterclose,$.extend(a,{beforeopen:function(a,c){return b._trigger("beforeopen",a,c)},afteropen:function(a,c){return b._trigger("afteropen",a,c)},beforeclose:function(a,c){return b._trigger("beforeclose",a,c)},afterclose:function(a,c){return b._trigger("afterclose",a,c)}})},createApiCloseOptions:function(){var a,b;return b=this,a={},delete a.beforeclose,delete a.afterclose,$.extend(a,{beforeclose:function(a,c){return b._trigger("beforeclose",a,c)},afterclose:function(a,c){return b._trigger("afterclose",a,c)}})},open:function(){return e.open(this._id,this.createApiOpenOptions())},close:function(){return e.close(this.createApiCloseOptions())}})})).call(this);
/*! jQuery.ui.domwindow - v0.1.4 -  10/26/2012
 * https://github.com/Takazudo/jQuery.ui.domwindow
 * Copyright (c) 2012 "Takazudo" Takeshi Takatsudo; Licensed MIT */// Generated by CoffeeScript 1.4.0
(function(){var e=[].slice;(function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;return s=t(n),i=t(r),v=Math.round,n.domwindowNs=c={},n.domwindowApi=u=null,b=c.widgets={$dialog:null,$overlay:null},c.ie6=function(){var e;return e=t("<div><!--[if IE 6]><i></i><![endif]--></div>"),e.find("i").length?!0:!1}(),c.isBlackListedMobile=function(){var e=window,t=navigator.userAgent,n=navigator.platform,r=t.match(/AppleWebKit\/([0-9]+)/),i=!!r&&r[1],s=t.match(/Fennec\/([0-9]+)/),o=!!s&&s[1],u=t.match(/Opera Mobi\/([0-9]+)/),a=!!u&&u[1];return(n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iPod")>-1)&&i&&i<534||e.operamini&&{}.toString.call(e.operamini)==="[object OperaMini]"||u&&a<7458||t.indexOf("Android")>-1&&i&&i<533||o&&o<6||"palmGetResource"in window&&i&&i<534||t.indexOf("MeeGo")>-1&&t.indexOf("NokiaBrowser/8.5.0")>-1?!0:!1},c.positionFixedUnavailable=c.ie6||c.isBlackListedMobile(),d=function(){return t.Deferred(function(e){return e.resolve()})},m=c.viewportH=function(){return n.innerHeight||r.documentElement.clientHeight||r.body.clientHeight},g=c.viewportW=function(){return n.innerWidth||r.documentElement.clientWidth||r.body.clientWidth},p=c.offsetY=function(){return n.pageYOffset||r.documentElement.scrollTop||r.body.scrollTop},h=c.offsetX=function(){return n.pageXOffset||r.documentElement.scrollLeft||r.body.scrollLeft},y=function(e){return t.Deferred(function(t){return setTimeout(function(){return t.resolve()},e)})},t.widget("ui.hideoverlay",{options:{overlayfade:!0,spinnersrc:null,maxopacity:.8,bgiframe:!1,forceabsolute:c.positionFixedUnavailable||!1,spinjs:!1,spinjs_options:{color:"#fff",lines:15,length:22,radius:40}},widgetEventPrefix:"hideoverlay.",_active:!1,_create:function(){return this.$el=this.element,this.$spinner=t(".ui-hideoverlay-spinner",this.$el),this.options.spinjs&&this.$spinner.css("background","none"),this.$bg=t(".ui-hideoverlay-bg",this.$el),this._preloadSpinner(),this._eventify(),this._handleLegacy(),this},_attachSpinjs:function(){return this._showDefer?this._spinning?(new Spinner(this.options.spinjs_options)).spin(this.$spinner[0]):this:this},_handleLegacy:function(){return this.options.forceabsolute?(this.$el.css("position","absolute"),this._resize(),this.options.bgiframe&&t.fn.bgiframe&&this.$el.bgiframe(),this):this},_resize:function(){var e,t;return this.options.forceabsolute?(t=g(),e=m(),this.$el.css({width:t,height:e,top:s.scrollTop(),left:s.scrollLeft()}),this.$bg.css({width:t,height:e})):this},_eventify:function(){var e=this;return this.options.forceabsolute?(s.bind("resize scroll",function(){return e._resize()}),this):this},_showOverlayEl:function(e){var n=this;return t.Deferred(function(r){var i,s;return n.$spinner.hide(),n.$el.css("display","block"),s={opacity:0},i={opacity:n.options.maxopacity},n.options.overlayfade?t.when(n.$bg.stop().css(s).animate(i,200)).done(function(){return e||(n.options.spinjs&&(n.$spinner.show(),n._attachSpinjs()),n.$spinner.hide().fadeIn()),r.resolve()}):(n.$bg.css(i),e||(n.options.spinjs&&(n.$spinner.show(),n._attachSpinjs()),n.$spinner.show()),r.resolve())}).promise()},_hideOverlayEl:function(){var e=this;return t.Deferred(function(n){var r,i;return r={opacity:0},i=function(){return e.$el.css("display","none"),e.$spinner.show(),n.resolve()},e.options.overlayfade?t.when(e.$bg.stop().animate(r,100)).done(function(){return i()}):(e.$bg.css(r),i())}).promise()},_preloadSpinner:function(){var e;return e=this.options.spinnersrc,e?((new Image).src=e,this):this},show:function(e){var t=this;return this._showDefer?this._showDefer:this._active?d():(this._active=!0,e?this.hideSpinner():(this._spinning=!0,this.$spinner.show()),this._trigger("showstart"),this._showDefer=this._showOverlayEl(e),this._showDefer.done(function(){return t._showDefer=null,t._trigger("showend")}),this._showDefer)},hide:function(){var e=this;return this._showDefer?(this._showDefer.done(function(){return e.hide()}),this):this._active?(this._active=!1,this._trigger("hidestart"),this._hideDefer=this._hideOverlayEl(),this._hideDefer.done(function(){return e._hideDefer=null,e._trigger("hideend")}),this._hideDefer):d()},hideSpinner:function(){return this._spinning=!1,this.$spinner.stop().empty().hide(),this}}),t.ui.hideoverlay.create=function(e){var n;return n='<div class="ui-hideoverlay" id="domwindow-hideoverlay">\n  <div class="ui-hideoverlay-bg"></div>\n  <div class="ui-hideoverlay-spinner"></div>\n</div>',t(n).hideoverlay(e)},t.ui.hideoverlay.destroy=function(e){return b.$overlay?(b.$overlay.hideoverlay("destroy").remove(),b.$overlay=null,!0):!1},t.ui.hideoverlay.setup=function(e){var n;return t.ui.hideoverlay.destroy(),n=t.ui.hideoverlay.create(e).appendTo("body"),b.$overlay=n,n},t.widget("ui.domwindowdialog",{options:{spinjs:!1,height:500,width:500,fixedMinY:30,selector_open:".apply-domwindow-open",selector_close:".apply-domwindow-close",ajaxdialog:!0,ajaxdialog_avoidcache:!0,ajaxdialog_mindelay:300,iframedialog:!1,iddialog:!1,overlay:!0,overlayclickclose:!0,forceabsolute:c.positionFixedUnavailable||!1},widgetEventPrefix:"domwindowdialog.",_create:function(){return this.$el=this.element,this.$el.css({width:this.options.width,height:this.options.height}),this._eventify(),this},_eventify:function(){var e,t=this;return e=this,i.on("click",this.options.selector_open,function(t){var n;return t.preventDefault(),n=l(this),e.open.apply(e,n)}),i.on("click",this.options.selector_close,function(e){return e.preventDefault(),t.close()}),s.on("resize",function(){return t.center()}),this},_appendFetchedData:function(e){return this.$el.empty().append(e),this},setOverlay:function(e){var t=this;return this.options.overlay?(this.$overlay=e,this.overlay=e.data("hideoverlay"),this.options.overlayclickclose&&this.$overlay.bind("click",function(){return t.close()}),this):this},center:function(){var e,t,n,r,i,s,o,u,a;return o={},e=this.$el.outerHeight(),t=this.$el.outerWidth(),a=g(),u=m(),s=p(),i=h(),r=a<t,n=u<e+50,r?(o.left=0,n?(o.position="absolute",o.top=this.options.fixedMinY+s):(o.position="absolute",o.top=v(u/2)-v(e/2)+s)):n?(o.position="absolute",o.top=this.options.fixedMinY+s,o.left=v(a/2)-v(t/2)+i):(o.top=v(u/2)-v(e/2),o.left=v(a/2)-v(t/2),this.options.forceabsolute?(o.position="absolute",o.top+=s,o.left+=i):o.position="fixed"),this.$el.css(o),this},open:function(n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g=this;c=r,this._isOpen=!0,this._currentOpen=o={},o.defer=t.Deferred(),s=function(){if(o.killed)return;return g.$el.fadeIn(200,function(){var e;return(e=g.overlay)!=null&&e.hideSpinner(),g._trigger("afteropen",{},{dialog:g.$el}),g._currentOpen=null}),y(0).done(function(){return g.center()}),o.defer.resolve()},f=null;if(t.isFunction(n))f="deferred";else if(n.indexOf("#")===0)f="id",n=n.replace(/^#/,"");else{this.options.ajaxdialog&&(f="ajax"),this.options.iframedialog&&(f="iframe"),this.options.iddialog&&(f="id");if(c!=null?c.ajaxdialog:void 0)f="ajax";if(c!=null?c.iframedialog:void 0)f="iframe";if(c!=null?c.iddialog:void 0)f="id"}f==="id"?(i=t("#"+n),this.$lastIdTarget=i,i.is(":ui-domwindow")?c=t.extend({},i.domwindow("createApiOpenOptions"),c):this.$lastIdTarget=null):this.$lastIdTarget=null,this._attachOneTimeEvents(c,"open",o),h=(c!=null?c.width:void 0)||this.options.width,l=(c!=null?c.height:void 0)||this.options.height,this.$el.css({width:h,height:l}),this._trigger("beforeopen",{},{dialog:this.$el}),a=this.options.ajaxdialog_mindelay;switch(f){case"deferred":(p=this.overlay)!=null&&p.show(),u=t.Deferred(),n.apply(this,[u]),t.when(u,y(a)).done(function(e){return g._appendFetchedData(e),s()});break;case"ajax":(d=this.overlay)!=null&&d.show(),t.when(this._ajaxGet(n),y(a)).done(function(){var t,n;return t=1<=arguments.length?e.call(arguments,0):[],n=t[0][0],g._appendFetchedData(n),s()});break;case"iframe":(v=this.overlay)!=null&&v.show(!0),this.$el.empty().append(this._createIframeSrc(n)),s();break;case"id":(m=this.overlay)!=null&&m.show(!0),this._appendFetchedData(i.html()),s()}return o.kill=function(){return o.killed=!0},o},close:function(e){var n=this;return t.Deferred(function(r){var i;return n._isOpen?(n.$lastIdTarget&&(e=t.extend({},e,n.$lastIdTarget.domwindow("createApiCloseOptions"))),n._attachOneTimeEvents(e,"close"),(i=n._currentOpen)!=null&&i.kill(),n._isOpen=!1,n._trigger("beforeclose",{},{dialog:n.$el}),y(0).done(function(){var e;return(e=n.overlay)!=null&&e.hide(),n.$el.fadeOut(200,function(){return r.resolve(),n._trigger("afterclose",{},{dialog:n.$el})})})):n})},_attachOneTimeEvents:function(n,r,i){var s,o=this;return n?(s=["beforeclose","afterclose"],r==="open"&&t.merge(s,["beforeopen","afteropen"]),t.each(s,function(t,r){if(n[r])return o.$el.one(""+o.widgetEventPrefix+r,function(){var t;t=1<=arguments.length?e.call(arguments,0):[];if(i!=null?i.killed:void 0)return;return n[r].apply(this.$el,t)})}),this):this},_ajaxGet:function(e){var n;return n={url:e,dataType:"text"},this.options.ajaxdialog_avoidcache&&(n.cache=!1),t.ajax(n)},_createIframeSrc:function(e){var t;return t=f(),'<iframe\n  frameborder="0" hspace="0" wspace="0" src="'+e+'" name="'+t+'"\n  style="width:100%; height:100%; border:none; background-color:#fff"\n></iframe>'}}),t.ui.domwindowdialog.create=function(e){var n;return n='<div class="ui-domwindowdialog"></div>',t(n).domwindowdialog(e)},t.ui.domwindowdialog.destroy=function(){return b.$dialog?(b.$dialog.domwindowdialog("destroy").remove(),b.$dialog=null,!0):!1},t.ui.domwindowdialog.setup=function(e){var r,i;return t.ui.domwindowdialog.destroy(),r=t.ui.domwindowdialog.create(e),r.appendTo("body"),i=a(e),r.domwindowdialog("setOverlay",t.ui.hideoverlay.setup(i)),u=n.domwindowApi=new o(r),b.$dialog=r,r},a=function(e){var n;return n={},e?(t.each(t.ui.hideoverlay.prototype.options,function(t){if(e[t]!==void 0)return n[t]=e[t]}),n):n},l=c.getInfoFromOpener=function(e){var n,r,i,s;return n=t(e),i=[],s=n.data("domwindowUrl")||n.data("domwindowId"),s||(s=n.attr("href").replace(/^#/,"")),i.push(s),r={},n.data("domwindowAjaxdialog")&&(r.ajaxdialog=!0),n.data("domwindowIframedialog")&&(r.iframedialog=!0),n.data("domwindowIddialog")&&(r.iddialog=!0),function(){var e;e=n.data("domwindowHeight");if(e)return r.height=e}(),function(){var e;e=n.data("domwindowWidth");if(e)return r.width=e}(),i.push(r),i},f=function(){return"domwindow-uniqid-"+Math.round(Math.random()*1e3)},o=function(){function t(e){this.$dialog=e,this.dialog=this.$dialog.data("domwindowdialog")}return t.prototype.open=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.dialog.open.apply(this.dialog,t)},t.prototype.close=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.dialog.close.apply(this.dialog,t)},t}(),t.widget("ui.domwindow",{options:{iddialog:!0},widgetEventPrefix:"domwindow.",_create:function(){var e=this;return this.$el=this.element,this._id=this.$el.attr("id")||function(){var t;return t=f(),e.$el.attr("id",t),t}(),this},createApiOpenOptions:function(){var e,n;return n=this,e=t.extend({},this.options),delete e.beforeopen,delete e.afteropen,delete e.beforeclose,delete e.afterclose,t.extend(e,{beforeopen:function(e,t){return n._trigger("beforeopen",e,t)},afteropen:function(e,t){return n._trigger("afteropen",e,t)}})},createApiCloseOptions:function(){var e,n;return n=this,e={},delete e.beforeopen,delete e.afteropen,delete e.beforeclose,delete e.afterclose,t.extend(e,{beforeclose:function(e,t){return n._trigger("beforeclose",e,t)},afterclose:function(e,t){return n._trigger("afterclose",e,t)}})},open:function(){return u.open(this._id,this.createApiOpenOptions())},close:function(){return u.close()}})})(jQuery,this,this.document)}).call(this);
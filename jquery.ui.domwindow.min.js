/*! jQuery.ui.domwindow (https://github.com/Takazudo/jQuery.ui.domwindow)
 * lastupdate: 2013-03-25
 * version: 0.2.2
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var e=[].slice;(function(i,t,n){var o,r,s,a,l,d,h,u,c,f,p,v,g,w,m,y;return r=i(t),o=i(n),v=Math.round,t.domwindowNs=u={},t.domwindowApi=a=null,y=u.widgets={$dialog:null,$overlay:null},u.ie6=function(){var e;return e=i("<div><!--[if IE 6]><i></i><![endif]--></div>"),e.find("i").length?!0:!1}(),u.isBlackListedMobile=function(){var e=window,i=navigator.userAgent,t=navigator.platform,n=i.match(/AppleWebKit\/([0-9]+)/),o=!!n&&n[1],r=i.match(/Fennec\/([0-9]+)/),s=!!r&&r[1],a=i.match(/Opera Mobi\/([0-9]+)/),l=!!a&&a[1];return(t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1||t.indexOf("iPod")>-1)&&o&&534>o||e.operamini&&"[object OperaMini]"==={}.toString.call(e.operamini)||a&&7458>l||i.indexOf("Android")>-1&&o&&533>o||s&&6>s||"palmGetResource"in window&&o&&534>o||i.indexOf("MeeGo")>-1&&i.indexOf("NokiaBrowser/8.5.0")>-1?!0:!1},u.positionFixedUnavailable=u.ie6||u.isBlackListedMobile(),p=function(){return i.Deferred(function(e){return e.resolve()})},g=u.viewportH=function(){return t.innerHeight||n.documentElement.clientHeight||n.body.clientHeight},w=u.viewportW=function(){return t.innerWidth||n.documentElement.clientWidth||n.body.clientWidth},f=u.offsetY=function(){return t.pageYOffset||n.documentElement.scrollTop||n.body.scrollTop},c=u.offsetX=function(){return t.pageXOffset||n.documentElement.scrollLeft||n.body.scrollLeft},m=function(e){return i.Deferred(function(i){return setTimeout(function(){return i.resolve()},e)})},i.widget("ui.hideoverlay",{options:{overlayfade:!0,spinnersrc:null,maxopacity:.8,bgiframe:!1,forceabsolute:u.positionFixedUnavailable||!1,spinjs:!1,spinjs_options:{color:"#fff",lines:15,length:22,radius:40}},widgetEventPrefix:"hideoverlay.",_active:!1,_create:function(){return this.$el=this.element,this.$spinner=i(".ui-hideoverlay-spinner",this.$el),this.options.spinjs&&this.$spinner.css("background","none"),this.$bg=i(".ui-hideoverlay-bg",this.$el),this._preloadSpinner(),this._eventify(),this._handleLegacy(),this},_attachSpinjs:function(){return this._showDefer?this._spinning?new Spinner(this.options.spinjs_options).spin(this.$spinner[0]):this:this},_handleLegacy:function(){return this.options.forceabsolute?(this.$el.css("position","absolute"),this._resize(),this.options.bgiframe&&i.fn.bgiframe&&this.$el.bgiframe(),this):this},_resize:function(){var e,i;return this.options.forceabsolute?(i=w(),e=g(),this.$el.css({width:i,height:e,top:r.scrollTop(),left:r.scrollLeft()}),this.$bg.css({width:i,height:e})):this},_eventify:function(){var e=this;return this.options.forceabsolute?(r.bind("resize scroll",function(){return e._resize()}),this):this},_showOverlayEl:function(e){var t=this;return i.Deferred(function(n){var o,r;return t.$spinner.hide(),t.$el.css("display","block"),r={opacity:0},o={opacity:t.options.maxopacity},t.options.overlayfade?i.when(t.$bg.stop().css(r).animate(o,200)).done(function(){return e||(t.options.spinjs&&(t.$spinner.show(),t._attachSpinjs()),t.$spinner.hide().fadeIn()),n.resolve()}):(t.$bg.css(o),e||(t.options.spinjs&&(t.$spinner.show(),t._attachSpinjs()),t.$spinner.show()),n.resolve())}).promise()},_hideOverlayEl:function(){var e=this;return i.Deferred(function(t){var n,o;return n={opacity:0},o=function(){return e.$el.css("display","none"),e.$spinner.show(),t.resolve()},e.options.overlayfade?i.when(e.$bg.stop().animate(n,100)).done(function(){return o()}):(e.$bg.css(n),o())}).promise()},_preloadSpinner:function(){var e;return(e=this.options.spinnersrc)?((new Image).src=e,this):this},show:function(e){var i=this;return this._showDefer?this._showDefer:this._active?p():(this._active=!0,e?this.hideSpinner():(this._spinning=!0,this.$spinner.show()),this._trigger("showstart"),this._showDefer=this._showOverlayEl(e),this._showDefer.done(function(){return i._showDefer=null,i._trigger("showend")}),this._showDefer)},hide:function(){var e=this;return this._showDefer?(this._showDefer.done(function(){return e.hide()}),this):this._active?(this._active=!1,this._trigger("hidestart"),this._hideDefer=this._hideOverlayEl(),this._hideDefer.done(function(){return e._hideDefer=null,e._trigger("hideend")}),this._hideDefer):p()},hideSpinner:function(){return this._spinning=!1,this.$spinner.stop().empty().hide(),this}}),i.ui.hideoverlay.create=function(e){var t;return t='<div class="ui-hideoverlay" id="domwindow-hideoverlay">\n  <div class="ui-hideoverlay-bg"></div>\n  <div class="ui-hideoverlay-spinner"></div>\n</div>',i(t).hideoverlay(e)},i.ui.hideoverlay.destroy=function(){return y.$overlay?(y.$overlay.hideoverlay("destroy").remove(),y.$overlay=null,!0):!1},i.ui.hideoverlay.setup=function(e){var t;return i.ui.hideoverlay.destroy(),t=i.ui.hideoverlay.create(e).appendTo("body"),y.$overlay=t,t},i.widget("ui.domwindowdialog",{options:{spinjs:!1,height:500,width:500,fixedMinY:30,selector_open:".apply-domwindow-open",selector_close:".apply-domwindow-close",ajaxdialog:!0,ajaxdialog_avoidcache:!0,ajaxdialog_mindelay:300,iframedialog:!1,iddialog:!1,overlay:!0,overlayclickclose:!0,forceabsolute:u.positionFixedUnavailable||!1,centeronresize:!0},widgetEventPrefix:"domwindowdialog.",_create:function(){return this.$el=this.element,this.$el.css({width:this.options.width,height:this.options.height}),this._eventify(),this},_eventify:function(){var e,i=this;return e=this,o.on("click",this.options.selector_open,function(i){var t;return i.preventDefault(),t=h(this),e.open.apply(e,t)}),o.on("click",this.options.selector_close,function(e){return e.preventDefault(),i.close()}),r.on("resize orientationchange",function(){return i.options.centeronresize?i.center():void 0}),this},_appendFetchedData:function(e){return this.$el.empty().append(e),this},setOverlay:function(e){var i=this;return this.options.overlay?(this.$overlay=e,this.overlay=e.data("uiHideoverlay"),this.options.overlayclickclose&&this.$overlay.bind("click",function(){return i.close()}),this):this},center:function(){var e,i,t,n,o,r,s,a,l;return s={},e=this.$el.outerHeight(),i=this.$el.outerWidth(),l=w(),a=g(),r=f(),o=c(),n=i>l,t=e+50>a,n?(s.left=0,t?(s.position="absolute",s.top=this.options.fixedMinY+r):(s.position="absolute",s.top=v(a/2)-v(e/2)+r)):t?(s.position="absolute",s.top=this.options.fixedMinY+r,s.left=v(l/2)-v(i/2)+o):(s.top=v(a/2)-v(e/2),s.left=v(l/2)-v(i/2),this.options.forceabsolute?(s.position="absolute",s.top+=r,s.left+=o):s.position="fixed"),this.$el.css(s),this},open:function(t,n){var o,r,s,a,l,d,h,u,c,f,p,v,g,w=this;switch(u=n,this._isOpen=!0,this._currentOpen=s={},s.defer=i.Deferred(),r=function(){return s.killed?void 0:(w.$el.fadeIn(200,function(){var e;return null!=(e=w.overlay)&&e.hideSpinner(),w._trigger("afteropen",{},{dialog:w.$el}),w._currentOpen=null}),m(0).done(function(){return w.center()}),s.defer.resolve())},d=null,i.isFunction(t)?d="deferred":0===t.indexOf("#")?(d="id",t=t.replace(/^#/,"")):(this.options.ajaxdialog&&(d="ajax"),this.options.iframedialog&&(d="iframe"),this.options.iddialog&&(d="id"),(null!=u?u.ajaxdialog:void 0)&&(d="ajax"),(null!=u?u.iframedialog:void 0)&&(d="iframe"),(null!=u?u.iddialog:void 0)&&(d="id")),"id"===d?(o=i("#"+t),this.$lastIdTarget=o,o.is(":ui-domwindow")?u=i.extend({},o.domwindow("createApiOpenOptions"),u):this.$lastIdTarget=null):this.$lastIdTarget=null,this._attachOneTimeEvents(u,"open",s),c=(null!=u?u.width:void 0)||this.options.width,h=(null!=u?u.height:void 0)||this.options.height,this.$el.css({width:c,height:h}),this._trigger("beforeopen",{},{dialog:this.$el}),l=this.options.ajaxdialog_mindelay,d){case"deferred":null!=(f=this.overlay)&&f.show(),a=i.Deferred(),t.apply(this,[a]),i.when(a,m(l)).done(function(e){return w._appendFetchedData(e),r()});break;case"ajax":null!=(p=this.overlay)&&p.show(),i.when(this._ajaxGet(t),m(l)).done(function(){var i,t;return i=arguments.length>=1?e.call(arguments,0):[],t=i[0][0],w._appendFetchedData(t),r()});break;case"iframe":null!=(v=this.overlay)&&v.show(!0),this.$el.empty().append(this._createIframeSrc(t)),r();break;case"id":null!=(g=this.overlay)&&g.show(!0),this._appendFetchedData(o.html()),r()}return s.kill=function(){return s.killed=!0},s},close:function(e){var t=this;return i.Deferred(function(n){var o;return t._isOpen?(t.$lastIdTarget&&(e=i.extend({},e,t.$lastIdTarget.domwindow("createApiCloseOptions"))),t._attachOneTimeEvents(e,"close"),null!=(o=t._currentOpen)&&o.kill(),t._isOpen=!1,t._trigger("beforeclose",{},{dialog:t.$el}),m(0).done(function(){var e;return null!=(e=t.overlay)&&e.hide(),t.$el.fadeOut(200,function(){return n.resolve(),t._trigger("afterclose",{},{dialog:t.$el})})})):t})},_attachOneTimeEvents:function(t,n,o){var r,s=this;return t?(r=["beforeclose","afterclose"],"open"===n&&i.merge(r,["beforeopen","afteropen"]),i.each(r,function(i,n){return t[n]?s.$el.one(""+s.widgetEventPrefix+n,function(){var i;return i=arguments.length>=1?e.call(arguments,0):[],(null!=o?!o.killed:true)?t[n].apply(this.$el,i):void 0}):void 0}),this):this},_ajaxGet:function(e){var t;return t={url:e,dataType:"text"},this.options.ajaxdialog_avoidcache&&(t.cache=!1),i.ajax(t)},_createIframeSrc:function(e){var i;return i=d(),'<iframe\n  frameborder="0" hspace="0" wspace="0" src="'+e+'" name="'+i+'"\n  style="width:100%; height:100%; border:none; background-color:#fff"\n></iframe>'}}),i.ui.domwindowdialog.create=function(e){var t;return t='<div class="ui-domwindowdialog"></div>',i(t).domwindowdialog(e)},i.ui.domwindowdialog.destroy=function(){return y.$dialog?(y.$dialog.domwindowdialog("destroy").remove(),y.$dialog=null,!0):!1},i.ui.domwindowdialog.setup=function(e){var n,o;return i.ui.domwindowdialog.destroy(),n=i.ui.domwindowdialog.create(e),n.appendTo("body"),o=l(e),n.domwindowdialog("setOverlay",i.ui.hideoverlay.setup(o)),a=t.domwindowApi=new s(n),y.$dialog=n,n},l=function(e){var t;return t={},e?(i.each(i.ui.hideoverlay.prototype.options,function(i){return void 0!==e[i]?t[i]=e[i]:void 0}),t):t},h=u.getInfoFromOpener=function(e){var t,n,o,r;return t=i(e),o=[],r=t.data("domwindowUrl")||t.data("domwindowId"),r||(r=t.attr("href").replace(/^#/,"")),o.push(r),n={},t.data("domwindowAjaxdialog")&&(n.ajaxdialog=!0),t.data("domwindowIframedialog")&&(n.iframedialog=!0),t.data("domwindowIddialog")&&(n.iddialog=!0),function(){var e;return e=t.data("domwindowHeight"),e?n.height=e:void 0}(),function(){var e;return e=t.data("domwindowWidth"),e?n.width=e:void 0}(),o.push(n),o},d=function(){return"domwindow-uniqid-"+Math.round(1e3*Math.random())},s=function(){function i(e){this.$dialog=e,this.dialog=this.$dialog.data("uiDomwindowdialog")}return i.prototype.open=function(){var i;return i=arguments.length>=1?e.call(arguments,0):[],this.dialog.open.apply(this.dialog,i)},i.prototype.close=function(){var i;return i=arguments.length>=1?e.call(arguments,0):[],this.dialog.close.apply(this.dialog,i)},i}(),i.widget("ui.domwindow",{options:{iddialog:!0},widgetEventPrefix:"domwindow.",_create:function(){var e=this;return this.$el=this.element,this._id=this.$el.attr("id")||function(){var i;return i=d(),e.$el.attr("id",i),i}(),this},createApiOpenOptions:function(){var e,t;return t=this,e=i.extend({},this.options),delete e.beforeopen,delete e.afteropen,delete e.beforeclose,delete e.afterclose,i.extend(e,{beforeopen:function(e,i){return t._trigger("beforeopen",e,i)},afteropen:function(e,i){return t._trigger("afteropen",e,i)}})},createApiCloseOptions:function(){var e,t;return t=this,e={},delete e.beforeopen,delete e.afteropen,delete e.beforeclose,delete e.afterclose,i.extend(e,{beforeclose:function(e,i){return t._trigger("beforeclose",e,i)},afterclose:function(e,i){return t._trigger("afterclose",e,i)}})},open:function(){return a.open(this._id,this.createApiOpenOptions())},close:function(){return a.close()}})})(jQuery,window,document)}).call(this);